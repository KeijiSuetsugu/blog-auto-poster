# 画像生成機能 設定ガイド

記事投稿時にサムネイル画像（アイキャッチ画像）を自動生成・設定する機能が追加されました。

## 機能概要

- **Unsplash API**（無料）または **DALL-E 3**（有料）で画像を自動生成
- 生成した画像をWordPressにアップロードし、アイキャッチ画像として設定
- 記事のテーマに関連した画像を自動選択

## 必要な環境変数

`.env`ファイルに以下の環境変数を追加してください：

```env
# OpenAI API設定（既存）
OPENAI_API_KEY=sk-your-openai-api-key-here

# WordPress設定（既存）
WORDPRESS_URL=https://your-wordpress-site.com
WORDPRESS_USERNAME=your-username
WORDPRESS_PASSWORD=your-application-password

# 画像生成設定（新規追加）
# 画像ソース: 'unsplash' または 'dalle'
IMAGE_SOURCE=unsplash

# Unsplash API設定（IMAGE_SOURCE=unsplashの場合に必要）
# https://unsplash.com/developers でアクセスキーを取得
UNSPLASH_ACCESS_KEY=your-unsplash-access-key-here

# DALL-E フォールバック設定（オプション）
# Unsplashが失敗した場合にDALL-E 3にフォールバックするか
DALLE_FALLBACK=false
```

## 設定方法

### 1. Unsplash API（無料・推奨）

**コスト**: 完全無料（月50リクエストまで）

**手順**:
1. [Unsplash Developers](https://unsplash.com/developers) にアクセス
2. アカウントを作成（無料）
3. 「New Application」をクリック
4. アプリケーション情報を入力
5. Access Keyをコピー
6. `.env`ファイルに追加：
   ```env
   IMAGE_SOURCE=unsplash
   UNSPLASH_ACCESS_KEY=your-access-key-here
   ```

**メリット**:
- 完全無料
- 高品質なプロフェッショナル写真
- 商用利用可能

**デメリット**:
- 記事内容との関連性は検索キーワード次第
- 既存の写真から選択（生成ではない）

### 2. DALL-E 3（有料）

**コスト**: 1枚あたり$0.04（1024×1024、standard品質）

**手順**:
1. OpenAI APIキーが既にあれば追加設定不要
2. `.env`ファイルに追加：
   ```env
   IMAGE_SOURCE=dalle
   ```

**メリット**:
- 記事内容に完全にカスタマイズされた画像
- ユニークな画像（他のサイトと被らない）
- 記事タイトルやテーマに基づいて生成

**デメリット**:
- 有料（1記事あたり約6円）
- 生成に時間がかかる（10-30秒）

### 3. ハイブリッド設定（推奨）

Unsplashをメインにして、失敗時のみDALL-E 3にフォールバック：

```env
IMAGE_SOURCE=unsplash
UNSPLASH_ACCESS_KEY=your-access-key-here
DALLE_FALLBACK=true
```

## GitHub Actionsでの設定

GitHub Secretsに以下を追加してください：

1. リポジトリの「Settings」→「Secrets and variables」→「Actions」
2. 「New repository secret」をクリック
3. 以下のシークレットを追加：
   - `UNSPLASH_ACCESS_KEY`（Unsplash使用時）
   - `IMAGE_SOURCE`（値: `unsplash` または `dalle`）
   - `DALLE_FALLBACK`（オプション、値: `true` または `false`）

## 使用方法

### 自動投稿（通常使用）

設定後、通常通り`wordpress_poster.py`を実行すると、自動的に画像が生成・アップロードされます：

```bash
python wordpress_poster.py
```

### 手動テスト

記事と画像を生成してテスト：

```bash
python article_generator.py
```

### プログラムから使用

```python
from article_generator import generate_article

# Unsplashで画像生成
article = generate_article(image_source='unsplash', generate_image=True)

# DALL-E 3で画像生成
article = generate_article(image_source='dalle', generate_image=True)

# 画像なし
article = generate_article(generate_image=False)

# 結果
print(article['title'])
print(article['content'])
if 'image_path' in article:
    print(f"画像: {article['image_path']}")
```

## トラブルシューティング

### Unsplash APIエラー

**エラー**: `⚠️ UNSPLASH_ACCESS_KEYが設定されていません`

**解決方法**:
- `.env`ファイルに`UNSPLASH_ACCESS_KEY`が正しく設定されているか確認
- アクセスキーに余分なスペースや改行がないか確認

### DALL-E 3エラー

**エラー**: `⚠️ DALL-E 3画像生成エラー`

**解決方法**:
- OpenAI APIキーが有効か確認
- アカウントに十分なクレジットがあるか確認
- 一時的にUnsplashに切り替える

### 画像アップロードエラー

**エラー**: `⚠️ 画像アップロード失敗: 403`

**解決方法**:
- WordPressのアプリケーションパスワードに「メディアアップロード」権限があるか確認
- WordPressのセキュリティプラグインがメディアアップロードをブロックしていないか確認

## コスト比較

### 月30記事投稿の場合

| 方法 | 月額コスト | 年間コスト |
|------|-----------|-----------|
| Unsplash | $0 | $0 |
| DALL-E 3 | $1.20 | $14.40 |
| ハイブリッド | $0〜$1.20 | $0〜$14.40 |

**推奨**: まずUnsplashで運用し、画質や関連性に不満がある場合のみDALL-E 3に切り替える。

## よくある質問

### Q: 画像生成をスキップできますか？

A: はい、環境変数を設定しなければ画像生成はスキップされ、記事のみ投稿されます。

### Q: 画像のサイズは変更できますか？

A: コード内で変更可能です。Unsplashは`regular`（1080px幅）、DALL-E 3は`1024x1024`がデフォルトです。

### Q: 画像の著作権は大丈夫ですか？

A: Unsplashは商用利用可能なライセンスです。DALL-E 3で生成した画像は、OpenAIの利用規約に従って使用できます。

### Q: 毎回違う画像が生成されますか？

A: はい、Unsplashはランダムに選択され、DALL-E 3は毎回新しい画像を生成します。

## サポート

問題が発生した場合は、以下を確認してください：

1. `.env`ファイルの設定
2. GitHub Secretsの設定（GitHub Actions使用時）
3. APIキーの有効性
4. WordPressのメディアアップロード権限

それでも解決しない場合は、エラーメッセージを確認して対処してください。

