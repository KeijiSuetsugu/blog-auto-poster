# 🔧 WordPress設定確認手順（403エラー対処）

## 状況

- ✅ ローカルでは投稿成功
- ✅ パスワードの長さは正しい（29文字）
- ❌ GitHub Actionsでは403エラー

これは、**WordPress側の設定**に問題がある可能性が高いです。

## 🔍 確認すべきWordPress設定

### 1. セキュリティプラグインの確認

多くのセキュリティプラグインは、REST APIへのアクセスを制限しています。

#### 確認手順

1. **WordPress管理画面にログイン**
   - https://freeeeeeestyle.com/wp-admin/

2. **プラグインを確認**
   - 左メニュー「プラグイン」→「インストール済みプラグイン」
   - 以下のようなセキュリティプラグインがあるか確認：
     - Wordfence Security
     - iThemes Security
     - All In One WP Security
     - Sucuri Security
     - その他のセキュリティプラグイン

3. **REST API制限を確認**
   - セキュリティプラグインの設定を開く
   - 「REST API」や「API」に関する設定を探す
   - 以下の設定があれば確認：
     - ✅ REST APIを有効にする
     - ✅ 認証されたユーザーのREST APIアクセスを許可
     - ❌ REST APIを無効にする（これがONになっていたら問題）

### 2. IP制限の確認

#### サーバー側のIP制限

1. **レンタルサーバーの管理画面にログイン**
   - お使いのレンタルサーバーの管理画面

2. **アクセス制限を確認**
   - 「セキュリティ」や「アクセス制限」の設定
   - 特定のIPアドレスのみ許可する設定になっていないか確認

3. **GitHub ActionsのIPアドレスを許可**
   - GitHub ActionsはIPアドレスが固定されていないため、IP制限があると動作しません
   - 解決策：
     - オプション1: REST APIへのIP制限を解除
     - オプション2: 別の方法（後述）を使用

### 3. ユーザー権限の確認

1. **WordPress管理画面にログイン**
   - https://freeeeeeestyle.com/wp-admin/

2. **ユーザー権限を確認**
   - 左メニュー「ユーザー」→「ユーザー一覧」
   - `onepeace0710` ユーザーを確認
   - 権限が「管理者」または「編集者」になっているか確認

3. **権限が不足している場合**
   - ユーザーの権限を「管理者」に変更

### 4. REST API設定の確認

1. **パーマリンク設定を更新**
   - 左メニュー「設定」→「パーマリンク設定」
   - 何も変更せず「変更を保存」をクリック
   - これでREST APIが再初期化されます

2. **REST APIが有効か確認**
   - ブラウザで以下にアクセス：
   ```
   https://freeeeeeestyle.com/wp-json/wp/v2
   ```
   - JSONデータが表示されればOK

### 5. アプリケーションパスワードの再作成

現在のアプリケーションパスワードに問題がある可能性があります。

1. **WordPress管理画面にログイン**
   - https://freeeeeeestyle.com/wp-admin/

2. **プロフィールページを開く**
   - 左メニュー「ユーザー」→「プロフィール」

3. **既存のアプリケーションパスワードを削除**
   - 「アプリケーションパスワード」セクション
   - 既存のパスワードの「取り消す」をクリック

4. **新しいアプリケーションパスワードを作成**
   - 名前を入力（例：「GitHub Actions用（新）」）
   - 「新しいアプリケーションパスワードを追加」をクリック
   - **表示されたパスワードを全てコピー**

5. **GitHub Secretsを更新**
   - https://github.com/KeijiSuetsugu/blog-auto-poster/settings/secrets/actions
   - `WORDPRESS_PASSWORD`を更新

## 🔧 代替案：プラグインを使用

GitHub ActionsのIPアドレスがブロックされている場合、以下のプラグインを使用する方法があります。

### WP REST API Controller

1. **プラグインをインストール**
   - WordPress管理画面 → プラグイン → 新規追加
   - 「WP REST API Controller」を検索
   - インストール → 有効化

2. **設定**
   - REST APIへのアクセスを許可する設定を確認

## 🆘 最終手段：ローカルから投稿

GitHub Actionsが使えない場合、ローカルPCから投稿する方法もあります。

### 方法1: cronジョブ（Mac）

```bash
# cronジョブを編集
crontab -e

# 以下を追加（毎日9時に実行）
0 9 * * * cd /Users/keiji/Desktop/開発/新規事業（人間関係） && /usr/local/bin/python3 main.py
```

### 方法2: Automator（Mac）

1. Automatorを開く
2. 「カレンダーアラーム」を選択
3. スクリプトを追加
4. カレンダーで毎日実行するように設定

## ✅ 確認チェックリスト

- [ ] セキュリティプラグインのREST API制限を確認
- [ ] サーバー側のIP制限を確認
- [ ] ユーザー権限が「管理者」または「編集者」か確認
- [ ] パーマリンク設定を更新
- [ ] REST APIが有効か確認（ブラウザでアクセス）
- [ ] アプリケーションパスワードを再作成
- [ ] GitHub Secretsを更新
- [ ] ワークフローを再実行

## 📝 次のステップ

1. 上記の設定を確認
2. 問題があれば修正
3. GitHub Actionsを再実行
4. それでもダメなら、エラーメッセージの詳細を確認

詳細なエラーメッセージが表示されるようにコードを更新しました。
次回のワークフロー実行時に、より詳しいエラー情報が表示されます。

